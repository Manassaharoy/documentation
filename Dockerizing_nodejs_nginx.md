# Docker installation and setup

## Folder structure: 

```
.
├── Backend
│   ├── Dockerfile
│   └── Node js source files
│ 
├── Frontend
│   ├── Dockerfile
│   ├── fullchain.pem (ssl certificate generated by let's encrypt)
│   ├── privkey.pem (ssl certificate generated by let's encrypt)
│   ├── default.conf (nginx config file)
│   └── React app source files
│  
└── docker-compose.yml

```



### <u>Frontend docker setup with NGINX configuration:</u>

This script will first run inside the react part. Dockerfile will in run the build command and copy the build folder to the container. And then it will run the nginx script. In the NGINX script it will load the NGINX image and then copy the default config file to the nginx directory. After that it will copy the pem files and build folder. Finally it will expose the default http and https ports. 

```
# pull the Node.js Docker image
FROM node:alpine as builder

# create the directory inside the container
WORKDIR ./Frontend

# copy the package.json files from local machine to the workdir in container
COPY package*.json ./

# run npm install in our local machine
RUN npm install --force

# copy the generated modules and all other files to the container
COPY . ./

# the command that starts our app
RUN npm run build

#stage 2

FROM nginx

# WORKDIR /usr/share/nginx/html
COPY default.conf /etc/nginx/conf.d/default.conf

# copies the pem files from current directory to destination folder
COPY fullchain.pem /etc/nginx/conf.d/fullchain.pem
COPY privkey.pem /etc/nginx/conf.d/privkey.pem

# Copies static resources from builder stage  --from=builder
COPY --from=builder ./Frontend/build /var/www/html

EXPOSE 80
EXPOSE 443

RUN chown nginx.nginx /var/www/html/ -R
# Containers run nginx with global directives and daemon off

# ENTRYPOINT ["nginx", "-g", "daemon off;"]
```

### <u>Backend docker setup with NGINX configuration:</u>

The script will get node installed in the VM and then from the working directory it will copy and install the packages to the container. Finally it will expose the node server port and start the app

```

# pull the Node.js Docker image
FROM node:alpine

# create the directory inside the container
WORKDIR ./Backend

# copy the package.json files from local machine to the workdir in container
COPY package*.json ./

# run npm install in our local machine
RUN npm install --force

# copy the generated modules and all other files to the container
COPY . .

# our app is running on port 5000 within the container, so need to expose it
EXPOSE 8082

# the command that starts our app
CMD ["node", "server.js"]

```

### <u>Building the docker compose file: </u>

The docker-compose.yml file will run the script files accordingly and we will be running the "docker-compose up" or "docker-compose up --build" to start the script. All docker related commands are in [Docker.md](https://github.com/Manassaharoy/documentation/blob/main/Docker.md) file.

Networks are used for internal communication between containers. In our case we haven't used it till now so the code is commented out.

```

version: "3.8"
services:
    nodeserver:
        build:
            context: ./Backend
        container_name: nodejsserver
        hostname: nodejsserver
        # networks:
        #     - app-network
        ports:
            - "8082:8082"
    frontend:
        build:
            context: ./Frontend
        container_name: nginx
        hostname: nginx
        # networks:
        #     - app-network
        ports:
            - "80:80"
            - "443:443"
# networks:
#     app-network: 
#         external: true

```


In case of container scaling the docker-compose.yml file will be:

```
version: "3.8"
services:
    nodeserver:
        build:
            context: ./Backend
    frontend:
        build:
            context: ./Frontend
        container_name: nginx
        hostname: nginx
        ports:
            - "80:80"
            - "443:443"

```


